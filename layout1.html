<!DOCTYPE html>
<html lang="en">
<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>Controlfrog - Meaningful Metrics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="css/styles.css" rel="stylesheet">

    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/controlfrog.css" rel="stylesheet" media="screen">
	<link href="favicon.ico" rel="shortcut icon" type="image/x-icon" />
	
	<script src="//code.jquery.com/jquery-1.9.1.min.js"></script>    
	<script src="js/moment.js"></script>	
	<script src="js/easypiechart.js"></script>
	<script src="js/gauge.js"></script>	
	<script src="js/chart.js"></script>
	<script src="js/jquery.sparklines.js"></script>			
    <script src="js/bootstrap.js"></script>
    <script src="js/controlfrog-plugins.js"></script>

    <script src="js/shake.js"></script>

    <!-- slider -->
    <link href="slider/css/slider.css" rel="stylesheet" />
    <script src="slider/js/bootstrap-slider.js"></script>
    <script src="js/modernizr-dev.js"></script>

    <!--[if lt IE 9]>
		<script src="js/respond.min.js"></script>
		<script src="js/excanvas.min.js"></script>
	<![endif]-->
    
    
	<script>
		var themeColour = 'white';
	</script>
    <script src="js/controlfrog.js"></script>
</head>
<body class="white">


    <div class="cf-container cf-nav-active">
        <div class="row"><!-- Top row -->
            <div class="col-sm-6 cf-item">
                <!-- top left -->
                <div class="inner">
                    <header>
                        <p><span></span>Control Panel</p>
                    </header>
                    <div class="content">
                        <div id="physicalAssetsContainer" class="panel panel-default">
                            <div class="panel-heading">Physical Assets</div>
                            <div class="panel-body">
                                <div class="row asset-type-row">
                                    <div class="col-xs-2">Equities</div>
                                    <div class="col-xs-9">
                                        <input type="text" data-bind="sliderValue: { value: controlPanel.controlPanelModel.equities, step: 10, max: 100 }" />
                                    </div>
                                    <div class="col-xs-1">
                                        <span data-bind="text: controlPanel.controlPanelModel.equities"></span>
                                    </div>
                                </div>
                                <div class="row asset-type-row">
                                    <div class="col-xs-2">Gilts</div>
                                    <div class="col-xs-9">
                                        <input type="text" data-bind="sliderValue: { value: controlPanel.controlPanelModel.gilts, step: 10, max: 100 }" />
                                    </div>
                                    <div class="col-xs-1">
                                        <span data-bind="text: controlPanel.controlPanelModel.gilts"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="syntheticAssetsContainer" class="panel panel-default">
                            <div class="panel-heading">Synthetic Assets</div>
                            <div class="panel-body">
                                <div class="row asset-type-row">
                                    <div class="col-xs-2">Swaps</div>
                                    <div class="col-xs-9">
                                        <input type="text" data-bind="sliderValue: { value: controlPanel.controlPanelModel.swaps, step: 10, max: 100 }" />
                                    </div>
                                    <div class="col-xs-1">
                                        <span data-bind="text: controlPanel.controlPanelModel.swaps"></span>
                                    </div>
                                </div>
                                <div class="row asset-type-row">
                                    <div class="col-xs-2">Vol Controlled Equities</div>
                                    <div class="col-xs-9">
                                        <input type="text" data-bind="sliderValue: { value: controlPanel.controlPanelModel.volControlledEquities, step: 10, max: 100 }" />
                                    </div>
                                    <div class="col-xs-1">
                                        <span data-bind="text: controlPanel.controlPanelModel.volControlledEquities"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-body">
                                Total: <span data-bind="text: controlPanel.controlPanelModel.totalAssets"></span>
                            </div>
                        </div>
                    </div>
                </div> <!-- //end inner -->
            </div>

            <div class="col-sm-6 cf-item">
                <!-- top right -->
                <div class="inner">
                    <header>
                        <p><span></span>PRMF</p>
                    </header>

                    <div class="content">

                        <table class="table table-prmf">

                            <tr>
                                <th class="cf-txts-txt m-red">Flight Plan</th>
                                <td class="m-red prmf-value">
                                    Required Return: 84 bps<br/>
                                    Expected Return: 146 bps
                                </td>
                                <td class="cf-bars-bar m-red mb prmf-status">

                                        <span class="glyphicon glyphicon-exclamation-sign prmf-icon"></span>

                                </td>
                            </tr>

                            <tr>
                                <th class="cf-txts-txt m-amber">Risk Budget</th>
                                <td class="m-amber prmf-value">
                                   RAR 9%
                                </td>
                                <td class="cf-bars-bar m-amber mb prmf-status">

                                    <span class="glyphicon glyphicon-minus-sign prmf-icon"></span>

                                </td>
                            </tr>

                            <tr>
                                <th class="cf-txts-txt m-amber">Hedge Ratio</th>
                                <td class="m-amber prmf-value">
                                    Hedge Ratio: 70%<br/>
                                    Funding Ratio: 69%
                                </td>
                                <td class="cf-bars-bar m-amber mb prmf-status">

                                    <span class="glyphicon glyphicon-minus-sign prmf-icon"></span>

                                </td>
                            </tr>


                            <tr>
                                <th class="cf-txts-txt m-green">Collateral</th>
                                <td class="m-green prmf-value">
                                    £444M
                                </td>
                                <td class="cf-bars-bar m-green mb prmf-status">

                                    <span class="glyphicon glyphicon-ok-sign prmf-icon"></span>

                                </td>
                            </tr>
                        </table>

                        <!--<div id="cf-rag-1" class="cf-rag">-->

                            <!--<div class="cf-txts ">-->
                                <!--<ul>-->
                                    <!--<li>-->
                                        <!--<div class="cf-txts-txt m-red">-->
                                            <!--<p>Return</p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-txts-txt m-amber">-->
                                            <!--<p>Risk</p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-txts-txt m-green">-->
                                            <!--<p>Collateral</p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-txts-txt m-green">-->
                                            <!--<p>Hedge</p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                <!--</ul>-->
                            <!--</div>-->

                            <!--<div class="cf-figs ">-->
                                <!--<ul>-->
                                    <!--<li>-->
                                        <!--<div class="cf-figs-fig m-red">-->
                                            <!--<p>56 bps</p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-figs-fig m-amber">-->
                                            <!--<p>£244m</p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-figs-fig m-green">-->
                                            <!--<p>£444m</p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-figs-fig m-green">-->
                                            <!--<p>95.5%</p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                <!--</ul>-->
                            <!--</div>-->

                            <!--<div class="cf-bars">-->
                                <!--<ul>-->
                                    <!--<li>-->
                                        <!--<div class="cf-bars-bar m-red mb prmf-status">-->
                                            <!--<span class="glyphicon glyphicon-exclamation-sign prmf-icon"></span>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-bars-bar m-amber mb prmf-status">-->
                                            <!--<span class="glyphicon glyphicon-minus-sign prmf-icon"></span>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-bars-bar m-green mb prmf-status">-->
                                            <!--<span class="glyphicon glyphicon-ok-sign prmf-icon"></span>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                    <!--<li>-->
                                        <!--<div class="cf-bars-bar m-green mb prmf-status">-->
                                            <!--<span class="glyphicon glyphicon-ok-sign prmf-icon"></span>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                <!--</ul>-->
                            <!--</div>-->
                        <!--</div>-->
                    </div>

                </div> <!-- //end inner -->

            </div>

        </div>
        <div class="row"><!-- Bottom row -->

            <div class="col-sm-6 cf-item">
                <!-- bottom left -->
                <div class="inner">
                    <header>
                            <p><span></span>Risk</p>
                    </header>
                    <div class="content">
                        <div class="new-settings-box">
                            <div class="container-fluid new-settings-box-content">
                                <div id="new-risk-settings-collapsible" class="row collapse in">
                                    <div class="new-settings-box-item">
                                        <span>Basis Risk:</span>
                                        <div class="btn-group btn-group-xs" data-toggle="buttons">
                                            <button type="button" class="btn btn-info" data-bind="click: risk.riskModel.includeBasisRisk, css: { active: risk.riskModel.basisRisk() === true }">On</button>
                                            <button type="button" class="btn btn-info" data-bind="click: risk.riskModel.excludeBasisRisk, css: { active: risk.riskModel.basisRisk() === false }">Off</button>
                                        </div>
                                    </div>
                                    <div class="new-settings-box-item">
                                        <span>Label:</span>
                                        <div class="btn-group btn-group-xs" data-toggle="buttons">
                                            <label class="btn btn-info active">
                                                <input type="radio" name="RAR" checked> fRAR
                                            </label>
                                            <label class="btn btn-info">
                                                <input type="radio" name="RAR"> RAR
                                            </label>
                                            <label class="btn btn-info">
                                                <input type="radio" name="RAR"> VAR
                                            </label>
                                            <label class="btn btn-info">
                                                <input type="radio" name="RAR"> CAR
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="new-settings-toggle">
                                        <!--<button type="button" class="btn btn-info btn-xs" data-toggle="collapse" data-target="#new-flightplan-settings-collapsible">Hide/Show</button>-->
                                        <i id="new-risk-settings-toggle" class="glyphicon glyphicon-cog"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="riskChart"></div>
                        <div class="risk-settings-box active">
                            <div class="risk-settings-box-toggle">
                                <i class="glyphicon glyphicon-cog"></i>
                            </div>
                            <div class="settings-box-content">
                                <div class="settings-box-item">
                                    <span>Basis risk:</span>
                                    <div class="btn-group btn-group-xs" data-toggle="buttons">
                                        <button type="button" class="btn btn-info" data-bind="click: risk.riskModel.includeBasisRisk, css: { active: risk.riskModel.basisRisk() === true }">On</button>
                                        <button type="button" class="btn btn-info" data-bind="click: risk.riskModel.excludeBasisRisk, css: { active: risk.riskModel.basisRisk() === false }">Off</button>
                                    </div>
                                </div>
                                <div class="settings-box-item">
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="riskSetting2" checked>
                                            fRAR
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="riskSetting2">
                                            RAR
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="riskSetting2">
                                            VAR
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="riskSetting2">
                                            CAR
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- //end inner -->
            </div>

            <div class="col-sm-6 cf-item">
                <!-- bottom right -->
                <div class="inner">
                    <header>
                        <p><span></span>Flight Plan</p>
                    </header>
                    <div class="content">
                        <div class="new-settings-box">
                            <div class="container-fluid new-settings-box-content">
                                <div id="new-flightplan-settings-collapsible" class="row collapse in">
                                    <div class="new-settings-box-item">
                                        <span>Target funding year:</span>
                                        <select class="form-control" data-bind="options: flightPlan.flightPlanModel.targetFundingYears, value: flightPlan.flightPlanModel.targetFundingYear"></select>
                                    </div>
                                    <div class="new-settings-box-item">
                                        <span>Contributions:</span>
                                        <select class="form-control">
                                            <option>£60m (-40%)</option>
                                            <option>£70m (-30%)</option>
                                            <option>£80m (-20%)</option>
                                            <option>£90m (-10%)</option>
                                            <option selected>£100m</option>
                                            <option>£110m (+10%)</option>
                                            <option>£120m (+20%)</option>
                                            <option>£130m (+30%)</option>
                                            <option>£140m (+40%)</option>
                                        </select>
                                    </div>
                                    <div class="new-settings-box-item">
                                        <span>Discount Basis:</span>
                                        <div class="radio">
                                            <label>
                                                <input type="radio" name="flightplanBasis" checked>
                                                Technical Provision
                                            </label>
                                        </div>
                                        <div class="radio">
                                            <label>
                                                <input type="radio" name="flightplanBasis">
                                                Self Sufficiency
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="new-settings-toggle">
                                        <!--<button type="button" class="btn btn-info btn-xs" data-toggle="collapse" data-target="#new-flightplan-settings-collapsible">Hide/Show</button>-->
                                        <i id="new-flightplan-settings-toggle" class="glyphicon glyphicon-cog"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="flightPlanChart" style="height: 400px;"></div>
                        <div class="flightplan-settings-box active">
                            <div class="flightplan-settings-box-toggle">
                                <i class="glyphicon glyphicon-cog"></i>
                            </div>
                            <div class="settings-box-content">
                                <div class="settings-box-item">
                                    <span>Target funding year:</span> <select class="form-control" data-bind="options: flightPlan.flightPlanModel.targetFundingYears, value: flightPlan.flightPlanModel.targetFundingYear"></select>
                                </div>
                                <div class="settings-box-item">
                                    <span>Contributions:</span>
                                    <select class="form-control">
                                        <option>£60m (-40%)</option>
                                        <option>£70m (-30%)</option>
                                        <option>£80m (-20%)</option>
                                        <option>£90m (-10%)</option>
                                        <option selected>£100m</option>
                                        <option>£110m (+10%)</option>
                                        <option>£120m (+20%)</option>
                                        <option>£130m (+30%)</option>
                                        <option>£140m (+40%)</option>
                                    </select>
                                </div>
                                <div class="settings-box-item">
                                    <span>Discount Basis:</span>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="flightplanBasis" checked>
                                            Technical Provision
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="flightplanBasis">
                                            Self Sufficiency
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- //end inner -->
            </div>

        </div>
    </div>

    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/highcharts-more.js"></script>

    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js"></script>
    <script src="js/app/services/chartHelper.js"></script>

    <script>



    $(function (){
       //attach  click handler to collapsible settings panels
       $('#new-flightplan-settings-toggle').on('click', function () {
           $('#new-flightplan-settings-collapsible').collapse('toggle');
       });

        $('#new-risk-settings-toggle').on('click', function () {
            $('#new-risk-settings-collapsible').collapse('toggle');
        });

        //hide the settings panels
        $('#new-risk-settings-collapsible').collapse('hide');
        $('#new-flightplan-settings-collapsible').collapse('hide');
    });

    $(function () {
        $('.flightplan-settings-box').animate({
            right: "-200px"
        }, 'slow').removeClass('active');

        $('.flightplan-settings-box-toggle').on('click', function () {
            if ($('.flightplan-settings-box').hasClass('active')){
                $('.flightplan-settings-box').animate({
                    right: '-200px'
                }, 'slow').removeClass('active')
            }else{
                $('.flightplan-settings-box').animate({
                    right: '0px'
                }, 'slow').addClass('active')
            }
        })
    });

    $(function () {
        $('.risk-settings-box').animate({
            left: '-229px'
        }, 'slow').removeClass('active');

        $('.risk-settings-box-toggle').on('click', function () {
            if ($('.risk-settings-box').hasClass('active')){
                $('.risk-settings-box').animate({
                    left: '-229px'
                }, 'slow').removeClass('active')
            }else{
                $('.risk-settings-box').animate({
                    left: '-29px'
                }, 'slow').addClass('active')
            }
        })
    });

        ko.bindingHandlers.sliderValue = {
            init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                var params = valueAccessor();

                //ensure valueAccessor is either an observable item or contains a 'value' item
                if (!(ko.isObservable(params) || params['value'])){
                    throw "You need to define an observable value for the sliderValue. Either pass the observable directly or in the 'value' field in the parameters";
                }

                var valueObservable;
                if (ko.isObservable(params)){       //if observable, create slider using params directly
                    valueObservable = params;
                    $(element).slider({value: ko.unwrap(params)});
                }else{                              //otherwise, replace params['value'] with the actual value and create slider using set of parameters
                    valueObservable = params['value'];
                    params['value'] = ko.unwrap(valueObservable);
                    $(element).slider(params);
                }

                $(element).on('slide', function (ev) {
                    valueObservable(ev.value);
                });
            },
            update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                var modelValue = valueAccessor();
                var valueObservable;
                if (ko.isObservable(modelValue)){
                    valueObservable = modelValue;
                }else{
                    valueObservable = modelValue['value'];
                }

                $(element).slider('setValue', valueObservable());
            }
        };
        
        var fp = fp || {};

        fp.RiskModel = function (dependencies) {
            var self = this;

            self.colours = ["#bdea74", "#eae874", "#2FABE9", "#FA5833"];
            self.chartData = ko.observableArray([]);
            self.riskTableOriginal = ko.observableArray([]);
            self.chartYAxisTitle = ko.observable('Percentage of Total Liabilities');
            self.basisRisk = ko.observable(true);

            self.options = {
                skip: 1,
                decimalPlaces: 2,
                drilldown: 'byName',
                drilldownColumnIndex: 1,
                na: '-'
            };

            self.includeBasisRisk = function(){
              self.basisRisk(true);
            };

            self.excludeBasisRisk = function(){
                self.basisRisk(false);
            };

            if (!dependencies) dependencies = {};
            self.chartWrapper = dependencies.chartWrapper || new irisHighChartWrapper();

            /* test new data */
            //self.chartDataUnProcessed = ko.observableArray([]);

            //self.waterfallDataUnProcessed([{"name":"Equity Risk","y":1.08},{"name":"Alternative Risk","y":0.53},{"name":"FX Risk","y":0.06},{"name":"Credit Risk","y":2.68},{"name":"Insurance Risk","y":0.66},{"name":"Interest Rate Risk","y":1.2},{"name":"Inflation Risk","y":1.95},{"name":"Interest Rate Basis Risk","y":2.9},{"name":"Inflation Basis Risk","y":3.13},{"name":"Diversification","y":-7.659999999999999},{"name":"Total","y":0}]);

            /* end test */


            self.waterfallData = ko.computed(function () {
                //var colours = ["#D94542", "#578BCA", "#819E43", "#B0C9F5", "#9EDAEB"];
                var colourIndex = -1;
                var currentCategory = "";
                var result = [];
                if (self.chartData().length === 0) return result;

                var stringData = ko.utils.stringifyJson(self.chartData());
                var copyOfOriginalData = JSON.parse(stringData);
                copyOfOriginalData.shift();

                var diversificationFound = false;

                ko.utils.arrayForEach(copyOfOriginalData, function (data) {
                    data.shift();

                    var pushData = true;
                    //do not push data if basisRisk is false and data in current iteration is Basis Risk related
                    if (self.basisRisk() === false && (data[0] === 'Interest Rate Basis Risk' || data[0] === 'Inflation Basis Risk')){
                        pushData = false;
                    }

                    if (data[0] !== null && diversificationFound === false && pushData) {
                        if (data[2] !== currentCategory) {
                            colourIndex += 1;
                            currentCategory = data[2];
                        }
                        var y = parseFloat(data[1]);
                        y *= 100;
                        if (data[0] === "Diversification") {
                            diversificationFound = true;
                            var y1 = parseFloat(y.toFixed(1)) - (parseFloat(y.toFixed(2)) * 2);
                            //result.push({ name: data[0], y: y1, color: colours[colourIndex] });
                            result.push({ name: data[0], y: y1 });
                        } else {
                            //result.push({ name: data[0], y: parseFloat(y.toFixed(2)), color: colours[colourIndex] });
                            result.push({ name: data[0], y: parseFloat(y.toFixed(2)) });
                        }
                    }
                });

                //result.push({ name: 'Total', y: 0, color: colours[colourIndex += 1] });
                result.push({ name: 'Total', y: 0 });

                return result;
            });

            self.totalSeriesData = ko.computed(function () {
                var result = [];
                if (self.chartData().length === 0) return result;

                var stringData = ko.utils.stringifyJson(self.chartData());
                var copyOfOriginalData = JSON.parse(stringData);
                copyOfOriginalData.shift();

                ko.utils.arrayForEach(copyOfOriginalData, function (data) {
                    data.shift();

                    var pushData = true;
                    //do not push data if basisRisk is false and data in current iteration is Basis Risk related
                    if (self.basisRisk() === false && (data[0] === 'Interest Rate Basis Risk' || data[0] === 'Inflation Basis Risk')){
                        pushData = false;
                    }
                    if (pushData) {
                        if (data[0] !== "Total" && data[0] !== null) {
                            result.push({ y: 0 });
                        } else if (data[0] === "Total") {
                            var y = parseFloat(data[1]);
                            y *= 100;
                            result.push({ y: y });
                        }
                    }
                });

                return result;
            });

            self.displayChart = ko.computed(function () {
                if (self.waterfallData().length === 0) return;
                if (self.totalSeriesData().length === 0) return;

                var options = {
                    chartId: "#riskChart",
                    waterFallData: self.waterfallData(),
                    independantData: self.totalSeriesData(),
                    yAxisTitle: self.chartYAxisTitle(),
                    xAxisTitle: "Risk Type",
                    xAxisRotation: -45,
                    dataLabels: true
                };

                self.chartWrapper.displayWaterfallChart(options);
            });
        };

        fp.FlightPlanModel = function (dependencies) {
            var self = this;

            if (!dependencies) dependencies = {};
            self.chartWrapper = dependencies.chartWrapper || new irisHighChartWrapper();

            self.chartData = ko.observableArray([]);
            self.targetFundingYear = ko.observable(2032);
            self.targetFundingYears = ko.observableArray([2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2035,2036,2037,2038]);

            var seriesData = [
                { name: 'Liabilities', color: '#2FABE9', data: []},
                { name: 'Required Return', color: '#FA5833', data: [] },
                { name: 'Expected Return', color: '#008000', data: [], dashStyle: 'shortdash' }
            ];

            var options = {
                renderTo: '#flightPlanChart',
                lineSeriesData: seriesData,
                yAxisTitle: "GBP Millions",
                xAxisTitle: "Date",
                dataLabels: true
            };

            var inMillions = function (num) {
                var result = Math.round(num / 1000000);
                return result;
            };


            self.displayChart = ko.computed(function () {
                if (self.chartData().length === 0) return;

                ko.utils.arrayForEach(self.chartData(), function (item, i) {
                    if (item[0] !== 'Date') {   //ignore if first item in array is 'Date' (this is the header)
                        var stamp = moment.utc(item[0]);
                        if (stamp != undefined){
                            var rr = [stamp.unix() * 1000 + 1000, inMillions(parseInt(item[1]))];
                            var l = [stamp.unix() * 1000 + 1000, inMillions(parseInt(item[2]))];


                            //fake expected return data for now
                            var erDummyShift = 0;
                            if (i < self.chartData().length - 1){
                                var erDummyShift = Math.floor(Math.random() * 50000000);
                                erDummyShift *= Math.floor(Math.random()*2) == 1 ? 1 : -1;
                            }
                            var er = [stamp.unix() * 1000 + 1000, inMillions(parseInt(item[1]) + erDummyShift)];

                            seriesData[0].data.push(l);
                            seriesData[1].data.push(rr);
                            seriesData[2].data.push(er);
                        }
                    }
                });

                self.chartWrapper.displayFlightPlanLineChart(options);
            });

            self.addOneToTargetFundingYear = function () {
                self.targetFundingYear(self.targetFundingYear() + 1);
            };

            self.subtractOneFromTargetFundingYear = function () {
                self.targetFundingYear(self.targetFundingYear() - 1);
            };
        };

        fp.ControlPanelModel = function () {
            var self = this;

            self.equities = ko.observable(30);
            self.gilts = ko.observable(60);
            self.swaps = ko.observable(80);
            self.volControlledEquities = ko.observable(50);
            self.totalAssets = ko.computed(function () {
                return self.equities() + self.gilts() + self.swaps() + self.volControlledEquities();
            });

            self.reset = function(){
                self.equities(30);
                self.gilts(60);
                self.swaps(80);
                self.volControlledEquities(50);
            }
        };
        

        fp.riskData = [["Date","Risk Type","Percentage of Total Liabilities","Category",null],["31 January 2014","Equity Risk","0.010765388","Asset Risk",null],["31 January 2014","Alternative Risk","0.00533794","Asset Risk",null],["31 January 2014","FX Risk","0.000576727","Asset Risk",null],["31 January 2014","Credit Risk","0.026769249","Asset Risk",null],["31 January 2014","Insurance Risk","0.006609667","Asset Risk",null],["31 January 2014","Interest Rate Risk","0.012016951","Liability Risk",null],["31 January 2014","Inflation Risk","0.019474715","Liability Risk",null],["31 January 2014","Interest Rate Basis Risk","0.028957407","Basis Risk",null],["31 January 2014","Inflation Basis Risk","0.031308809","Basis Risk",null],["31 January 2014","Diversification","0.076792724","Diversification",null],["31 January 2014","Total","0.06502413","Total",null]];

        fp.flightPlanData = [["Date","GF Asset (Gilts +177bps)","GF Liability (Gilt flat)",null,null],["28 June 2013","1419816589","1824449370",null,null],["30 September 2013","1416916182","1818554559",null,null],["30 June 2014","1412647751","1793890195",null,null],["30 June 2015","1417703004","1769838176",null,null],["30 June 2016","1429176417","1754250356",null,null],["30 June 2017","1453465547","1754488164",null,null],["30 June 2018","1482378990","1759952119",null,null],["30 June 2019","1513284499","1767020958",null,null],["30 June 2020","1542372293","1778332423",null,null],["30 June 2021","1578037371","1796684312",null,null],["30 June 2022","1619577242","1820908259",null,null],["30 June 2023","1659350486","1841652201",null,null],["30 June 2024","1682379988","1842430887",null,null],["30 June 2025","1699311422","1835617536",null,null],["30 June 2026","1715221123","1826781602",null,null],["30 June 2027","1732560717","1818281248",null,null],["30 June 2028","1749060877","1807627789",null,null],["30 June 2029","1762273714","1792263917",null,null],["30 June 2030","1774795214","1774795214",null,null]];

        fp.ViewModel = function(){
            var self = this;

            self.controlPanel = {
                controlPanelModel: new fp.ControlPanelModel()
            };

            self.prmf = {

            };

            self.risk = {
                riskModel : new fp.RiskModel(new irisHighChartWrapper())
            };

            self.flightPlan = {
                flightPlanModel: new fp.FlightPlanModel({ chartWrapper: new irisHighChartWrapper() })
            };

            self.reset = function(){
                if (confirm("Reset the flight plan?")) {
                    self.controlPanel.controlPanelModel.reset();
                }
            };

            window.addEventListener('shake', self.reset, false);
        };

        var vm = new fp.ViewModel();
        vm.risk.riskModel.chartData(fp.riskData);
        vm.flightPlan.flightPlanModel.chartData(fp.flightPlanData);
        ko.applyBindings(vm);

//        $(function () {
//            window.addEventListener('shake', shakeEventDidOccur, false);
//
//            //function to call when shake occurs
//            function shakeEventDidOccur () {
//
//                //put your own code here etc.
//                if (confirm("Reset the flight plan?")) {
//                    vm.reset();
//                }
//            }
//        });

    </script>

</body>
</html>

