<!DOCTYPE html>
<html lang="en">
<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <title>Controlfrog - Meaningful Metrics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/controlfrog.css" rel="stylesheet" media="screen">   
	<link href="favicon.ico" rel="shortcut icon" type="image/x-icon" />
	
	<script src="//code.jquery.com/jquery-1.9.1.min.js"></script>    
	<script src="js/moment.js"></script>	
	<script src="js/easypiechart.js"></script>
	<script src="js/gauge.js"></script>	
	<script src="js/chart.js"></script>
	<script src="js/jquery.sparklines.js"></script>			
    <script src="js/bootstrap.js"></script>
    <script src="js/controlfrog-plugins.js"></script>
    <script src="js/modernizr-dev.js"></script>

    <!-- slider -->
    <link href="slider/css/slider.css" rel="stylesheet" />
    <script src="slider/js/bootstrap-slider.js"></script>


    <!--[if lt IE 9]>
		<script src="js/respond.min.js"></script>
		<script src="js/excanvas.min.js"></script>
	<![endif]-->
    
    
	<script>
		var themeColour = 'white';
	</script>
    <script src="js/controlfrog.js"></script>
</head>
<body class="white">


    <div class="cf-container cf-nav-active">
        <div class="row"><!-- Top row -->
            <div class="col-sm-6 cf-item">
                <!-- top left -->
                <div class="inner">
                    <header>
                        <p><span></span>Control Panel</p>
                    </header>
                    <div class="content">
                        <table class="table table-hover table-borderless">
                            <tbody>
                            <tr>
                                <td class="col-sm-2">Equities</td>
                                <td class="col-sm-8">
                                    <input type="text" data-bind="sliderValue: controlPanel.equities" />
                                </td>
                                <td class="col-sm-1"><span data-bind="text: controlPanel.equities"></span></td>
                            </tr>
                            <tr>
                                <td>Gilts</td>
                                <td>
                                    <input type="text" data-bind="sliderValue: controlPanel.gilts" />
                                </td>
                                <td><span data-bind="text: controlPanel.gilts"></span></td>
                            </tr>
                            <tr>
                                <td>Swaps</td>
                                <td>
                                    <input type="text" data-bind="sliderValue: controlPanel.swaps" />
                                </td>
                                <td><span data-bind="text: controlPanel.swaps"></span></td>
                            </tr>
                            <tr>
                                <td>Synthetic Assets</td>
                                <td>
                                    <input type="text" data-bind="sliderValue: { value: controlPanel.syntheticAssets, step: 10, max: 200 }" />
                                </td>
                                <td><span data-bind="text: controlPanel.syntheticAssets"></span></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div> <!-- //end inner -->
            </div>

            <div class="col-sm-6 cf-item">
                <!-- top right -->
                <div class="inner">
                    <header>
                        <p><span></span>PRMF</p>
                    </header>

                    <div class="content">
                        <div id="cf-rag-1" class="cf-rag">

                            <div class="cf-txts ">
                                <ul>
                                    <li>
                                        <div class="cf-txts-txt m-red">
                                            <p>Return</p>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="cf-txts-txt m-amber">
                                            <p>Risk</p>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="cf-txts-txt m-green">
                                            <p>Collateral</p>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="cf-txts-txt m-green">
                                            <p>Hedge</p>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="cf-figs ">
                                <ul>
                                    <li>
                                        <div class="cf-figs-fig m-red">
                                            <p>56 bps</p>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="cf-figs-fig m-amber">
                                            <p>£244m</p>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="cf-figs-fig m-green">
                                            <p>£444m</p>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="cf-figs-fig m-green">
                                            <p>95.5%</p>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="cf-bars">
                                <ul>
                                    <li style="height: 25%">
                                        <div class="cf-bars-bar m-red mb"></div>
                                    </li>
                                    <li style="height: 25%">
                                        <div class="cf-bars-bar m-amber mb"></div>
                                    </li>
                                    <li style="height: 25%">
                                        <div class="cf-bars-bar m-green mb">
                                            <i class="glyphicon glyphicon-ok"></i>
                                        </div>
                                    </li>
                                    <li style="height: 25%">
                                        <div class="cf-bars-bar m-green mb"></div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                </div> <!-- //end inner -->

            </div>

        </div>
        <div class="row"><!-- Bottom row -->

            <div class="col-sm-6 cf-item">
                <!-- bottom left -->
                <div class="inner">
                    <header>
                        <p><span></span>Bottom Left</p>
                    </header>
                </div> <!-- //end inner -->
            </div>

            <div class="col-sm-6 cf-item">
                <!-- bottom right -->
                <div class="inner">
                    <header>
                        <p><span></span>Flight Plan</p>
                    </header>

                    <div class="content">
                        <div id="flightPlan" style="height: 400px"></div>
                    </div>
                </div> <!-- //end inner -->
            </div>

        </div>
    </div>


    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js"></script>

    <script>

        ko.bindingHandlers.sliderValue = {
            init: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                var params = valueAccessor();

                //ensure valueAccessor is either an observable item or contains a 'value' item
                if (!(ko.isObservable(params) || params['value'])){
                    throw "You need to define an observable value for the sliderValue. Either pass the observable directly or in the 'value' field in the parameters";
                }

                var valueObservable;
                if (ko.isObservable(params)){       //if observable, create slider using params directly
                    valueObservable = params;
                    $(element).slider({value: ko.unwrap(params)});
                }else{                              //otherwise, replace params['value'] with the actual value and create slider using set of parameters
                    valueObservable = params['value'];
                    params['value'] = ko.unwrap(valueObservable);
                    $(element).slider(params);
                }

                $(element).on('slide', function (ev) {
                    valueObservable(ev.value);
                });
            },
            update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                var modelValue = valueAccessor();
                var valueObservable;
                if (ko.isObservable(modelValue)){
                    valueObservable = modelValue;
                }else{
                    valueObservable = modelValue['value'];
                }

                $(element).slider('setValue', valueObservable());
            }
        };

        var fp = fp || {};

        fp.FlightPlanModel = function (dependencies) {
            var self = this;

            if (!dependencies) dependencies = {};
            self.chartWrapper = dependencies.chartWrapper || new lineChartWrapper();

            self.chartData = ko.observableArray();

            var seriesData = [
                { data: [], label: 'Liabilities' },
                { data: [], label: 'Assets' }
            ];

            var options = {
                id: "#flightPlan",
                seriesData: seriesData,
                colours: ["#2FABE9", "#FA5833"],
                yLabel: "GBP Millions",
                xLabel: "Date"
            };

            var inMillions = function (num) {
                var result = Math.round(num / 1000000);
                return result;
            }

            self.displayChart = ko.computed(function () {

                ko.utils.arrayForEach(self.chartData, function (item) {
                    if (item[0] !== 'Date') {
                        var stamp = moment.utc(item[0]);
                        if (stamp != undefined) {
                            var l = [stamp.unix() * 1000 + 1000, me.inMillions(parseInt(item[1]))]; // liabilities
                            var a = [stamp.unix() * 1000 + 1000, me.inMillions(parseInt(item[2]))]; // assets
                            seriesData[0].data.push(l);
                            seriesData[1].data.push(a)
                        }
                    }
                });

                //self.chartWrapper.displayFlightPlanChart(options);
                //me.flightPlanChart = new LineChart(options);
                //me.flightPlanChart.display();
            });
        };

        fp.flightPlanData = [["Date","GF Asset (Gilts +177bps)","GF Liability (Gilt flat)",null,null],["28 June 2013","1419816589","1824449370",null,null],["30 September 2013","1416916182","1818554559",null,null],["30 June 2014","1412647751","1793890195",null,null],["30 June 2015","1417703004","1769838176",null,null],["30 June 2016","1429176417","1754250356",null,null],["30 June 2017","1453465547","1754488164",null,null],["30 June 2018","1482378990","1759952119",null,null],["30 June 2019","1513284499","1767020958",null,null],["30 June 2020","1542372293","1778332423",null,null],["30 June 2021","1578037371","1796684312",null,null],["30 June 2022","1619577242","1820908259",null,null],["30 June 2023","1659350486","1841652201",null,null],["30 June 2024","1682379988","1842430887",null,null],["30 June 2025","1699311422","1835617536",null,null],["30 June 2026","1715221123","1826781602",null,null],["30 June 2027","1732560717","1818281248",null,null],["30 June 2028","1749060877","1807627789",null,null],["30 June 2029","1762273714","1792263917",null,null],["30 June 2030","1774795214","1774795214",null,null]];

        fp.ViewModel = function () {
            var self = this;

            self.controlPanel = {
                equities: ko.observable(1),
                gilts: ko.observable(6),
                swaps: ko.observable(8),
                syntheticAssets: ko.observable(50)
            };

            self.prmf = {

            };

            self.risk = {

            };

            self.flightPlan = {
                //flightPlanModel: new fp.FlightPlanModel(new lineChartWrapper())
            };
        };

        var vm = new fp.ViewModel();
        //vm.flightPlan.chartData(fp.flightPlanData);
        ko.applyBindings(vm);

    </script>

</body>
</html>

